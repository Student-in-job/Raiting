--- 1.1  Local@dmin!
CREATE VIEW I1 AS 
SELECT university.id as ID, university.name as name, 
(raiting.px/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END)*100 as I11, 
(raiting.py/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END)*100 as I12,
(3*raiting.px+raiting.py)*100/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END as I1,
YEAR
FROM raiting inner join university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I1_dolya_pps_s_uchenoy_stepenyu AS 
SELECT ID, name, I11, I12, I1, 4*I1/(SELECT MAX(I1) FROM I1 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I1 outer

GO

--- 1.2
CREATE VIEW I2 AS 
SELECT university.id as ID, university.name as name, 
(raiting.n5+raiting.n4)/CASE raiting.n1 WHEN 0 THEN 1 ELSE raiting.n1 END AS T1,
(raiting.n5+raiting.n4)/CASE raiting.n2 WHEN 0 THEN 1 ELSE raiting.n2 END AS T2,
(raiting.n5+raiting.n4)/CASE raiting.n3 WHEN 0 THEN 1 ELSE raiting.n3 END AS T3,
(raiting.n5+raiting.n4)/CASE WHEN(raiting.n1*raiting.t)=0 THEN 1 ELSE (raiting.n1*raiting.t) END AS I21,
(raiting.n5+raiting.n4)/CASE WHEN(raiting.n2*raiting.t)=0 THEN 1 ELSE (raiting.n2*raiting.t) END AS I22,
(raiting.n5+raiting.n4)/CASE WHEN(raiting.n3*raiting.t)=0 THEN 1 ELSE (raiting.n3*raiting.t) END AS I23,
((raiting.n5+raiting.n4)*((3/CASE raiting.n1 WHEN 0 THEN 1 ELSE raiting.n1 END)+(2/CASE raiting.n2 WHEN 0 THEN 1 ELSE raiting.n2 END)+(2/CASE raiting.n3 WHEN 0 THEN 1 ELSE raiting.n3 END)))/CASE raiting.t WHEN 0 THEN 1 ELSE (3*raiting.t) END AS I2,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I2_uroven_kachestva_prepodavaniya AS 
SELECT ID, name, T1, T2, T3, I21, I22, I23, I2, 7*I2/(SELECT MAX(I2) FROM I2 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I2 outer

GO

--- 1.3
CREATE VIEW I3 AS 
SELECT university.id as ID, university.name as name, 
(raiting.s1/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END)*100 as I31, 
(raiting.s2/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END)*100 as I32,
(raiting.s3/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END)*100 as I33,
(3*raiting.s1+raiting.s2+raiting.s3)*100/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END as I3,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I3_kolichestvo_uchebnikov_i_posobiy AS 
SELECT ID, name, I31, I32, I33, I3, 5*I3/(SELECT MAX(I3) FROM I3 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I3 outer

GO

--- 1.4
CREATE VIEW I4 AS 
SELECT university.id as ID, university.name as name,  
(raiting.p2/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END)*100 as I41,
(raiting.p3/CASE raiting.p1 WHEN 0 THEN 1 ELSE raiting.p1 END)*100 as I42,
((2*raiting.p2/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END)+(raiting.p3/CASE raiting.p1 WHEN 0 THEN 1 ELSE raiting.p END))*100 as I4,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I4_dolya_inostrannih_prepodavateley_i_studentov AS 
SELECT ID, name, I41, I42, I4, 3*I4/(SELECT MAX(I4) FROM I4 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I4 outer

GO

--- 1.5
CREATE VIEW I5 AS 
SELECT university.id as ID, university.name as name, 
(((raiting.p4+2*raiting.p5_1+raiting.p6_1)/CASE raiting.p1 WHEN 0 THEN 1 ELSE raiting.p1 END)+(2*raiting.p5+raiting.p6)/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END) as I5, 
(raiting.p4/CASE raiting.p1 WHEN 0 THEN 1 ELSE raiting.p1 END) as I51,
(raiting.p5_1/CASE raiting.p1 WHEN 0 THEN 1 ELSE raiting.p1 END) as I52_1,
(raiting.p5/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END) as I52_2,
(raiting.p6_1/CASE raiting.p1 WHEN 0 THEN 1 ELSE raiting.p1 END) as I53_1,
(raiting.p6/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END) as I53_2,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I5_uchastie_v_programme_obmena AS 
SELECT ID, name, I51, I52_1, I52_2, I53_1, I53_2, I5, 4*I5/(SELECT MAX(I5) FROM I5 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I5 outer

GO

--- 1.6
CREATE VIEW I6 AS 
SELECT university.id as ID, university.name as name, 
(raiting.k1/CASE raiting.k WHEN 0 THEN 1 ELSE raiting.k END)*100 as I6,
YEAR 
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I6_kolichestvo_uchebnih_kursov_na_inostrannom AS 
SELECT ID, name, I6, 3*I6/(SELECT MAX(I6) FROM I6 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I6 outer

GO


--- 1.7
CREATE VIEW I7 AS 
SELECT university.id as ID, university.name as name, 
(3*raiting.p7+2*raiting.p8)/(2*CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END) AS I7,
raiting.p7/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I71,
raiting.p8/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I72,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I7_uroven_angliyskogo_i_ikt_u_pps AS 
SELECT ID, name, I71, I72, I7, 5*I7/(SELECT MAX(I7) FROM I7 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I7 outer

GO

--- 1.8
CREATE VIEW I8 AS 
SELECT university.id as ID, university.name as name, 
(raiting.pz/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END)*100 AS I8,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I8_dolya_pps_prepodayushih_v_zarubejnih_vuzah AS 
SELECT ID, name, I8, 3*I8/(SELECT MAX(I8) FROM I8 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I8 outer

GO

--- 1.9
CREATE VIEW I9 AS 
SELECT university.id as ID, university.name as name, 
(raiting.p9/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END) AS I9,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I9_dolya_pps_prepodayushego_v_sspo AS 
SELECT ID, name, I9, I9/(SELECT MAX(I9) FROM I9 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I9 outer

GO

--- 2.1
CREATE VIEW I10 AS 
SELECT university.id as ID, university.name as name, 
(raiting.tsi/CASE raiting.tsti WHEN 0 THEN 1 ELSE raiting.tsti END)*100 AS I10,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I10_rezultati_attestacii_u_studentov AS 
SELECT ID, name, I10, 7*I10/(SELECT MAX(I10) FROM I10 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I10 outer

GO

--- 2.2
CREATE VIEW I11 AS 
SELECT university.id as ID, university.name as name, 
(raiting.r1/CASE raiting.r WHEN 0 THEN 1 ELSE raiting.r END)*100 AS I11,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I11_ocenka_kvalifikacii_vipusknikov_rabotodatelyami AS 
SELECT ID, name, I11, 5*I11/(SELECT MAX(I11) FROM I11 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I11 outer

GO

--- 2.3
CREATE VIEW I12 AS 
SELECT university.id as ID, university.name as name, 
5*raiting.p10/CASE raiting.p11 WHEN 0 THEN 1 ELSE raiting.p11 END AS I12,
raiting.p10/CASE raiting.p11 WHEN 0 THEN 1 ELSE raiting.p11 END AS I12_1,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I12_dolya_trudoustroennih_vipusknikov AS 
SELECT ID, name, I12_1, I12, 5*I12/(SELECT MAX(I12) FROM I12 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I12 outer

GO

--- 2.4
CREATE VIEW I13 AS 
SELECT university.id as ID, university.name as name, 
(1.6*raiting.p1_2+0.8*raiting.p1_3+0.4*raiting.p1_4+0.2*raiting.p1_5)/CASE raiting.p1 WHEN 0 THEN 1 ELSE raiting.p1 END AS I13,
raiting.p1_2/CASE raiting.p1 WHEN 0 THEN 1 ELSE raiting.p1 END AS I131,
raiting.p1_3/CASE raiting.p1 WHEN 0 THEN 1 ELSE raiting.p1 END AS I132,
raiting.p1_4/CASE raiting.p1 WHEN 0 THEN 1 ELSE raiting.p1 END AS I133,
raiting.p1_5/CASE raiting.p1 WHEN 0 THEN 1 ELSE raiting.p1 END AS I134,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I13_kolichestvo_studentov_udostoennih_nagrad AS 
SELECT ID, name, I131, I132, I133, I134, I13, 3*I13/(SELECT MAX(I13) FROM I13 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I13 outer

GO

--- 3.1
CREATE VIEW I14 AS 
SELECT university.id as ID, university.name as name,
(2*raiting.s4+5*raiting.s5)/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I14,
raiting.s4/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I141,
raiting.s5/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I142,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I14_citiruemost_publikaciy_pps AS 
SELECT ID, name, I141, I142, I14, 7*I14/(SELECT MAX(I14) FROM I14 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I14 outer

GO

--- 3.2
CREATE VIEW I15 AS 
SELECT university.id as ID, university.name as name,
(2*raiting.s7+raiting.s8+raiting.s9)/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I15,
raiting.s7/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I151,
raiting.s8/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I152,
raiting.s9/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I153,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I15_kolichestvo_izdannih_statey AS 
SELECT ID, name, I151, I152, I153, I15, 4*I15/(SELECT MAX(I15) FROM I15 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I15 outer

GO

--- 3.3
CREATE VIEW I16 AS 
SELECT university.id as ID, university.name as name,
((2*raiting.d/(CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END - CASE raiting.z WHEN 0 THEN 1 ELSE raiting.z END - CASE raiting.v WHEN 0 THEN 1 ELSE raiting.v END))+(2*raiting.z+2*raiting.v)/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END)*100 AS I16,
(raiting.d/(CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END-CASE raiting.z WHEN 0 THEN 1 ELSE raiting.z END-CASE raiting.v WHEN 0 THEN 1 ELSE raiting.v END))*100 AS I161,
((raiting.z+raiting.v)/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END)*100 AS I162,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I16_kolichestvo_sotrudnikov_utverjdennih_vak AS 
SELECT ID, name, I161, I162, I16, 4*I16/(SELECT MAX(I16) FROM I16 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I16 outer

GO

--- 3.4
CREATE VIEW I17 AS 
SELECT university.id as ID, university.name as name,
(3*raiting.t4+2*raiting.t5+2*raiting.t6+raiting.tl)/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I17,
raiting.t4/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I171,
raiting.t5/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I172,
raiting.t6/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I173,
raiting.tl/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I174,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I17_summa_finansovih_sredstv_poluchennih_na_nauchnuyu_deyatelnost AS 
SELECT ID, name, I171, I172, I173, I174, I17, 8*I17/(SELECT MAX(I17) FROM I17 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I17 outer

GO

--- 3.5
CREATE VIEW I18 AS 
SELECT university.id as ID, university.name as name,
(raiting.i+raiting.t7+raiting.t8+raiting.ya+raiting.kl)/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I18,
raiting.i/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I181,
raiting.t7/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I182,
raiting.t8/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I183,
raiting.ya/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I184,
raiting.kl/CASE raiting.p WHEN 0 THEN 1 ELSE raiting.p END AS I185,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I18_effektivnost_provodimih_nauchnih_rabot AS 
SELECT ID, name, I181, I182, I183, I184, I185, I18, 5*I18/(SELECT MAX(I18) FROM I18 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I18 outer

GO

--- 3.6
CREATE VIEW I19 AS 
SELECT university.id as ID, university.name as name,
raiting.a1 AS Z1,
0.75*raiting.a2 AS Z2,
0.5*raiting.a3 AS Z3,
0.25*raiting.a4 AS Z4,
0*raiting.a5 AS Z5,
(raiting.a1+0.75*raiting.a2+0.5*raiting.a3+0.25*raiting.a4)/(CASE raiting.a1 WHEN 0 THEN 1 ELSE raiting.a1 END+raiting.a2+raiting.a3+raiting.a4+raiting.a5) AS Z,
(2*(raiting.a1+0.75*raiting.a2+0.5*raiting.a3+0.25*raiting.a4)/(CASE raiting.a1 WHEN 0 THEN 1 ELSE raiting.a1 END+raiting.a2+raiting.a3+raiting.a4+raiting.a5)) AS I19,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I19_stepen_osnashennosti_laboratoriy_oborudovaniem AS 
SELECT ID, name, Z1, Z2, Z3, Z4, Z5, Z, I19, 2*I19/(SELECT MAX(I19) FROM I19 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I19 outer

GO

--- 4.1
CREATE VIEW I20 AS 
SELECT university.id as ID, university.name as name,
(2*raiting.k2+raiting.m)/(2*CASE raiting.l WHEN 0 THEN 1 ELSE raiting.l END) AS I20,
raiting.k2/CASE raiting.l WHEN 0 THEN 1 ELSE raiting.l END AS I201,
YEAR
FROM raiting INNER JOIN university
	ON raiting.id_university = university.id;

GO

CREATE VIEW I20_obespechennost_irc_uchebnoy_literaturoy AS 
SELECT ID, name, I201, I20, 3*I20/(SELECT MAX(I20) FROM I20 inner WHERE inner.year = outer.year) AS mark, YEAR
FROM I20 outer
